<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>第 4 章  网络层 | 10cks</title>
<meta name="keywords" content=", " />
<meta name="description" content="网络层提供的两种服务 虚电路服务 数据报服务 概要: 虚电路服务与数据报服务的对比 网际协议 IP 网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：  地址解析协议 ARP (Address Resolution Protocol) 逆地址解析协议 RARP (Reverse Address Resolution Protocol) 网际控制报文协议 ICMP (Internet Control Message Protocol) 网际组管理协议 IGMP (Internet Group Management Protocol) 概要: 示意图  虚拟互连网络  网络互相连接起来要使用一些中间设备  物理层中继系统：转发器(repeater)。 数据链路层中继系统：网桥或桥接器(bridge)。 网络层中继系统：路由器(router)。 网桥和路由器的混合物：桥路器(brouter)。 网络层以上的中继系统：网关(gateway)。    IP 数据报的格式  版本 : 有 4（IPv4）和 6（IPv6）两个值； 首部长度 : 占 4 位，因此最大值为 15。值为 1 表示的是 1 个 32 位字的长度，也就是 4 字节。因为固定部分长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。 区分服务 : 用来获得更好的服务，一般情况下不使用。 总长度 : 包括首部长度和数据部分长度。 生存时间 ：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由器跳数为单位，当 TTL 为 0 时就丢弃数据报。 协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。 首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。 标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。 片偏移 : 和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。  IP数据报分片   概要: 示意图  分类的 IP 地址  IP 地址的编址方式经历了三个历史阶段：  分类  由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。 IP 地址 ::= {&lt; 网络号 &gt;, &lt; 主机号 &gt;}  示意图     子网划分  通过在主机号字段中拿一部分作为子网号，把两级 IP 地址划分为三级 IP 地址。      IP 地址 ::= {&lt; 网络号 &gt;, &lt; 子网号 &gt;, &lt; 主机号 &gt;}">
<meta name="author" content="">
<link rel="canonical" href="https://10cks.top/posts/%E7%AC%AC4%E7%AB%A0-%E7%BD%91%E7%BB%9C%E5%B1%82/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.614c578e9f3a0d96e577bc6e656ce49997ce576f755a65caaa5defab0078a7b7.css" integrity="sha256-YUxXjp86DZbld7xuZWzkmZfOV291WmXKql3vqwB4p7c=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js" integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://10cks.top/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://10cks.top/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://10cks.top/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://10cks.top/apple-touch-icon.png">
<link rel="mask-icon" href="https://10cks.top/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');

            }
        }
    })();
</script>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
            .post-entry:hover {
				transition: transform 0.5s;
				-webkit-transform: scale(1.2);
				-moz-transform: scale(1.2);
				-ms-transform: scale(1.2);
				-o-transform: scale(1.2);
				transform: scale(1.03) translateZ(0) translate3d(0, 0, 0) rotate(0.01deg);
			}
        }

    </style>
</noscript><link rel='stylesheet' href='//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css'>
<script
    src="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/nprogress.min.js"
    integrity="sha384-bHDlAEUFxsRI7JfULv3DTpL2IXbbgn4JHQJibgo5iiXSK6Iu8muwqHANhun74Cqg"
    crossorigin="anonymous"
></script>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/css/nprogress.css"
    integrity="sha384-KJyhr2syt5+4M9Pz5dipCvTrtvOmLk/olWVdfhAp858UCa64Ia5GFpTN7+G4BWpE"
    crossorigin="anonymous"
/>
<script>
    NProgress.start();
    document.addEventListener("readystatechange", () => {
        if (document.readyState === "interactive") NProgress.inc(0.8);
        if (document.readyState === "complete") NProgress.done();
    });
</script><meta property="og:title" content="第 4 章  网络层" />
<meta property="og:description" content="网络层提供的两种服务 虚电路服务 数据报服务 概要: 虚电路服务与数据报服务的对比 网际协议 IP 网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：  地址解析协议 ARP (Address Resolution Protocol) 逆地址解析协议 RARP (Reverse Address Resolution Protocol) 网际控制报文协议 ICMP (Internet Control Message Protocol) 网际组管理协议 IGMP (Internet Group Management Protocol) 概要: 示意图  虚拟互连网络  网络互相连接起来要使用一些中间设备  物理层中继系统：转发器(repeater)。 数据链路层中继系统：网桥或桥接器(bridge)。 网络层中继系统：路由器(router)。 网桥和路由器的混合物：桥路器(brouter)。 网络层以上的中继系统：网关(gateway)。    IP 数据报的格式  版本 : 有 4（IPv4）和 6（IPv6）两个值； 首部长度 : 占 4 位，因此最大值为 15。值为 1 表示的是 1 个 32 位字的长度，也就是 4 字节。因为固定部分长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。 区分服务 : 用来获得更好的服务，一般情况下不使用。 总长度 : 包括首部长度和数据部分长度。 生存时间 ：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由器跳数为单位，当 TTL 为 0 时就丢弃数据报。 协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。 首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。 标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。 片偏移 : 和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。  IP数据报分片   概要: 示意图  分类的 IP 地址  IP 地址的编址方式经历了三个历史阶段：  分类  由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。 IP 地址 ::= {&lt; 网络号 &gt;, &lt; 主机号 &gt;}  示意图     子网划分  通过在主机号字段中拿一部分作为子网号，把两级 IP 地址划分为三级 IP 地址。      IP 地址 ::= {&lt; 网络号 &gt;, &lt; 子网号 &gt;, &lt; 主机号 &gt;}" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://10cks.top/posts/%E7%AC%AC4%E7%AB%A0-%E7%BD%91%E7%BB%9C%E5%B1%82/" /><meta property="og:image" content="https://10cks.top/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-03T14:41:48&#43;08:00" />
<meta property="article:modified_time" content="2022-05-03T14:41:48&#43;08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://10cks.top/papermod-cover.png"/>

<meta name="twitter:title" content="第 4 章  网络层"/>
<meta name="twitter:description" content="网络层提供的两种服务 虚电路服务 数据报服务 概要: 虚电路服务与数据报服务的对比 网际协议 IP 网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：  地址解析协议 ARP (Address Resolution Protocol) 逆地址解析协议 RARP (Reverse Address Resolution Protocol) 网际控制报文协议 ICMP (Internet Control Message Protocol) 网际组管理协议 IGMP (Internet Group Management Protocol) 概要: 示意图  虚拟互连网络  网络互相连接起来要使用一些中间设备  物理层中继系统：转发器(repeater)。 数据链路层中继系统：网桥或桥接器(bridge)。 网络层中继系统：路由器(router)。 网桥和路由器的混合物：桥路器(brouter)。 网络层以上的中继系统：网关(gateway)。    IP 数据报的格式  版本 : 有 4（IPv4）和 6（IPv6）两个值； 首部长度 : 占 4 位，因此最大值为 15。值为 1 表示的是 1 个 32 位字的长度，也就是 4 字节。因为固定部分长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。 区分服务 : 用来获得更好的服务，一般情况下不使用。 总长度 : 包括首部长度和数据部分长度。 生存时间 ：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由器跳数为单位，当 TTL 为 0 时就丢弃数据报。 协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。 首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。 标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。 片偏移 : 和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。  IP数据报分片   概要: 示意图  分类的 IP 地址  IP 地址的编址方式经历了三个历史阶段：  分类  由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。 IP 地址 ::= {&lt; 网络号 &gt;, &lt; 主机号 &gt;}  示意图     子网划分  通过在主机号字段中拿一部分作为子网号，把两级 IP 地址划分为三级 IP 地址。      IP 地址 ::= {&lt; 网络号 &gt;, &lt; 子网号 &gt;, &lt; 主机号 &gt;}"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://10cks.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "第 4 章  网络层",
      "item": "https://10cks.top/posts/%E7%AC%AC4%E7%AB%A0-%E7%BD%91%E7%BB%9C%E5%B1%82/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "第 4 章  网络层",
  "name": "第 4 章  网络层",
  "description": "网络层提供的两种服务 虚电路服务 数据报服务 概要: 虚电路服务与数据报服务的对比 网际协议 IP 网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：  地址解析协议 ARP (Address Resolution Protocol) 逆地址解析协议 RARP (Reverse Address Resolution Protocol) 网际控制报文协议 ICMP (Internet Control Message Protocol) 网际组管理协议 IGMP (Internet Group Management Protocol) 概要: 示意图  虚拟互连网络  网络互相连接起来要使用一些中间设备  物理层中继系统：转发器(repeater)。 数据链路层中继系统：网桥或桥接器(bridge)。 网络层中继系统：路由器(router)。 网桥和路由器的混合物：桥路器(brouter)。 网络层以上的中继系统：网关(gateway)。    IP 数据报的格式  版本 : 有 4（IPv4）和 6（IPv6）两个值； 首部长度 : 占 4 位，因此最大值为 15。值为 1 表示的是 1 个 32 位字的长度，也就是 4 字节。因为固定部分长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。 区分服务 : 用来获得更好的服务，一般情况下不使用。 总长度 : 包括首部长度和数据部分长度。 生存时间 ：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由器跳数为单位，当 TTL 为 0 时就丢弃数据报。 协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。 首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。 标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。 片偏移 : 和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。  IP数据报分片   概要: 示意图  分类的 IP 地址  IP 地址的编址方式经历了三个历史阶段：  分类  由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。 IP 地址 ::= {\u0026lt; 网络号 \u0026gt;, \u0026lt; 主机号 \u0026gt;}  示意图     子网划分  通过在主机号字段中拿一部分作为子网号，把两级 IP 地址划分为三级 IP 地址。      IP 地址 ::= {\u0026lt; 网络号 \u0026gt;, \u0026lt; 子网号 \u0026gt;, \u0026lt; 主机号 \u0026gt;}",
  "keywords": [
    "", ""
  ],
  "articleBody": "网络层提供的两种服务 虚电路服务 数据报服务 概要: 虚电路服务与数据报服务的对比 网际协议 IP 网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：  地址解析协议 ARP (Address Resolution Protocol) 逆地址解析协议 RARP (Reverse Address Resolution Protocol) 网际控制报文协议 ICMP (Internet Control Message Protocol) 网际组管理协议 IGMP (Internet Group Management Protocol) 概要: 示意图  虚拟互连网络  网络互相连接起来要使用一些中间设备  物理层中继系统：转发器(repeater)。 数据链路层中继系统：网桥或桥接器(bridge)。 网络层中继系统：路由器(router)。 网桥和路由器的混合物：桥路器(brouter)。 网络层以上的中继系统：网关(gateway)。    IP 数据报的格式  版本 : 有 4（IPv4）和 6（IPv6）两个值； 首部长度 : 占 4 位，因此最大值为 15。值为 1 表示的是 1 个 32 位字的长度，也就是 4 字节。因为固定部分长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。 区分服务 : 用来获得更好的服务，一般情况下不使用。 总长度 : 包括首部长度和数据部分长度。 生存时间 ：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由器跳数为单位，当 TTL 为 0 时就丢弃数据报。 协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。 首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。 标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。 片偏移 : 和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。  IP数据报分片   概要: 示意图  分类的 IP 地址  IP 地址的编址方式经历了三个历史阶段：  分类  由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。 IP 地址 ::= {, }  示意图     子网划分  通过在主机号字段中拿一部分作为子网号，把两级 IP 地址划分为三级 IP 地址。      IP 地址 ::= {, , }\n要使用子网，必须配置子网掩码。一个 B 类地址的默认子网掩码为 255.255.0.0，如果 B 类地址的子网占两个比特，那么子网掩码为 11111111 11111111 11000000 00000000，也就是 255.255.192.0。\n注意，外部网络看不到子网的存在。 * 无分类 * 无分类编址 CIDR 消除了传统 A 类、B 类和 C 类地址以及划分子网的概念，使用网络前缀和主机号来对 IP 地址进行编码，网络前缀的长度可以根据需要变化。\nIP 地址 ::= {, }\nCIDR 的记法上采用在 IP 地址后面加上网络前缀长度的方法，例如 128.14.35.7/20 表示前 20 位为网络前缀。\nCIDR 的地址掩码可以继续称为子网掩码，子网掩码首 1 长度为网络前缀的长度。\n一个 CIDR 地址块中有很多地址，一个 CIDR 表示的网络就可以表示原来的很多个网络，并且在路由表中只需要一个路由就可以代替原来的多个路由，减少了路由表项的数量。把这种通过使用网络前缀来减少路由表项的方式称为路由聚合，也称为 构成超网 。\n在路由表中的项目由“网络前缀”和“下一跳地址”组成，在查找时可能会得到不止一个匹配结果，应当采用最长前缀匹配来确定应该匹配哪一个。\nIP 地址与硬件地址  IP层抽象的互联网屏蔽了下层很复杂的细节 在抽象的网络层上讨论问题，就能够使用 统一的、抽象的 IP 地址 研究主机和主机或主机和路由器之间的通信  示意图    地址解析协议 ARP 与逆地址解析协议RARP  缘由  网络层实现主机之间的通信，而链路层实现具体每段链路之间的通信。因此在通信过程中，IP 数据报的源地址和目的地址始终不变，而 MAC 地址随着链路的改变而改变。   地址解析协议 ARP  ARP 实现由 IP 地址得到 MAC 地址  每个主机都有一个 ARP 高速缓存，里面有本局域网上的各主机和路由器的 IP 地址到 MAC 地址的映射表。      如果主机 A 知道主机 B 的 IP 地址，但是 ARP 高速缓存中没有该 IP 地址到 MAC 地址的映射，此时主机 A 通过广播的方式发送 ARP 请求分组，主机 B 收到该请求后会发送 ARP 响应分组给主机 A 告知其 MAC 地址，随后主机 A 向其高速缓存中写入主机 B 的 IP 地址到 MAC 地址的映射。 * 示意图\n 逆地址解析协议 RARP  逆地址解析协议 RARP 使只知道自己硬件地址的主机能够知道其 IP 地址。  这种主机往往是无盘工作站。 因此 RARP协议目前已很少使用。      IP 层转发分组的流程  分组转发算法  (1) 从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。 (2) 若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行(3)。 (3) 若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行(4)。 (4) 若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行(5)。 (5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行(6)。 (6) 报告转发分组出错。 概要: 示意图    划分子网和构造超网 划分子网 使用子网时分组转发 无分类编址 CIDR（构造超网） 网际控制报文协议 ICMP 简介  ICMP 是为了更有效地转发 IP 数据报和提高交付成功的机会。它封装在 IP 数据报中，但是不属于高层协议。  ICMP 报文的种类  ICMP 差错报告报文  终点不可达 源点抑制(Source quench) 时间超过 参数问题 改变路由（重定向）(Redirect)   ICMP 询问报文  回送请求和回答报文 时间戳请求和回答报文   ICMP 报文的前 4 个字节是统一的格式，共有三个字段：即类型、代码和检验和。接着的 4 个字节的内容与 ICMP 的类型有关。  ICMP 的应用举例    Ping   Ping 是 ICMP 的一个重要应用，主要用来测试两台主机之间的连通性。    Ping 的原理是通过向目的主机发送 ICMP Echo 请求报文，目的主机收到之后会发送 Echo 回答报文。Ping 会根据时间和成功响应的次数估算出数据包往返时间以及丢包率。\n  Traceroute   Traceroute 是 ICMP 的另一个应用，用来跟踪一个分组从源点到终点的路径。    Traceroute 发送的 IP 数据报封装的是无法交付的 UDP 用户数据报，并由目的主机发送终点不可达差错报告报文。 * 源主机向目的主机发送一连串的 IP 数据报。第一个数据报 P1 的生存时间 TTL 设置为 1，当 P1 到达路径上的第一个路由器 R1 时，R1 收下它并把 TTL 减 1，此时 TTL 等于 0，R1 就把 P1 丢弃，并向源主机发送一个 ICMP 时间超过差错报告报文； * 源主机接着发送第二个数据报 P2，并把 TTL 设置为 2。P2 先到达 R1，R1 收下后把 TTL 减 1 再转发给 R2，R2 收下后也把 TTL 减 1，由于此时 TTL 等于 0，R2 就丢弃 P2，并向源主机发送一个 ICMP 时间超过差错报文。 * 不断执行这样的步骤，直到最后一个数据报刚刚到达目的主机，主机不转发数据报，也不把 TTL 值减 1。但是因为数据报封装的是无法交付的 UDP，因此目的主机要向源主机发送 ICMP 终点不可达差错报告报文。 * 之后源主机知道了到达目的主机所经过的路由器 IP 地址以及到达每个路由器的往返时间。\n因特网的路由选择协议 有关路由选择协议的几个基本概念  静态路由选择策略——即非自适应路由选择，其特点是简单和开销较小，但不能及时适应网络状态的变化。 动态路由选择策略——即自适应路由选择，其特点是能较好地适应网络状态的变化，但实现起来较为复杂，开销也比较大。  自治系统 AS(Autonomous System)  自治系统 AS 的定义：在单一的技术管理下的一组路由器，而这些路由器使用一种 AS 内部的路由选择协议和共同的度量以确定分组在该 AS 内的路由，同时还使用一种 AS 之间的路由选择协议用以确定分组在 AS之间的路由。  内部网关协议 IGP (Interior Gateway Protocol)  即在一个自治系统内部使用的路由选择协议。  内部网关协议 RIP  RIP 是一种基于距离向量的路由选择协议。距离是指跳数，直接相连的路由器跳数为 1。跳数最多为 15，超过 15 表示不可达。      RIP 按固定的时间间隔仅和相邻路由器交换自己的路由表，经过若干次交换之后，所有路由器最终会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器地址。 * 距离向量算法： * 对地址为 X 的相邻路由器发来的 RIP 报文，先修改报文中的所有项目，把下一跳字段中的地址改为 X，并把所有的距离字段加 1； * 对修改后的 RIP 报文中的每一个项目，进行以下步骤： * 若原来的路由表中没有目的网络 N，则把该项目添加到路由表中； * 否则：若下一跳路由器地址是 X，则把收到的项目替换原来路由表中的项目；否则：若收到的项目中的距离 d 小于路由表中的距离，则进行更新（例如原始路由表项为 Net2, 5, P，新表项为 Net2, 4, X，则更新）；否则什么也不做。 * 若 3 分钟还没有收到相邻路由器的更新路由表，则把该相邻路由器标为不可达，即把距离置为 16。 * RIP 协议实现简单，开销小。但是 RIP 能使用的最大距离为 15，限制了网络的规模。并且当网络出现故障时，要经过比较长的时间才能将此消息传送到所有路由器。 * 内部网关协议 OSPF * 开放最短路径优先 OSPF，是为了克服 RIP 的缺点而开发出来的。\n开放表示 OSPF 不受某一家厂商控制，而是公开发表的；最短路径优先表示使用了 Dijkstra 提出的最短路径算法 SPF。 * OSPF 具有以下特点： * 向本自治系统中的所有路由器发送信息，这种方法是洪泛法。 * 发送的信息就是与相邻路由器的链路状态，链路状态包括与哪些路由器相连以及链路的度量，度量用费用、距离、时延、带宽等来表示。 * 只有当链路状态发生变化时，路由器才会发送信息。 * 所有路由器都具有全网的拓扑结构图，并且是一致的。相比于 RIP，OSPF 的更新过程收敛的很快。\n外部网关协议 BGP (External Gateway Protocol)  若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。 AS 之间的路由选择很困难，主要是由于：  互联网规模很大； 各个 AS 内部使用不同的路由选择协议，无法准确定义路径的度量； AS 之间的路由选择必须考虑有关的策略，比如有些 AS 不愿意让其它 AS 经过。   BGP 只能寻找一条比较好的路由，而不是最佳路由。  每个 AS 都必须配置 BGP 发言人，通过在两个相邻 BGP 发言人之间建立 TCP 连接来交换路由信息。 * 示意图\n路由器的构成  路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任务是转发分组。也就是说，将路由器某个输入端口收到的分组，按照分组要去的目的地（即目的网络），把该分组从路由器的某个合适的输出端口转发给下一跳路由器。 路由器从功能上可以划分为  路由选择 分组转发   分组转发结构由三个部分组成  交换结构 一组输入端口 一组输出端口 概要: 示意图    IP 多播 IP 多播的基本概念  多播可明显地减少网络中资源的消耗  在局域网上进行硬件多播 因特网组管理协议 IGMP 和多播路由选择协议  IGMP 使多播路由器\u000b知道多播组成员信息 多播转发必须动态地适应多播组成员的变化（这时网络拓扑并未发生变化）。请注意，单播路由选择通常是在网络拓扑发生变化时才需要更新路由。  虚拟专用网 VPN 和网络地址转换 NAT 虚拟专用网 VPN  由于 IP 地址的紧缺，一个机构能申请到的 IP 地址数往往远小于本机构所拥有的主机数。并且一个机构并不需要把所有的主机接入到外部的互联网中，机构内的计算机可以使用仅在本机构有效的 IP 地址（专用地址）。  有三个专用地址块：  10.0.0.0 ~ 10.255.255.255 172.16.0.0 ~ 172.31.255.255 192.168.0.0 ~ 192.168.255.255     VPN 使用公用的互联网作为本机构各专用网之间的通信载体。专用指机构内的主机只与本机构内的其它主机通信；虚拟指好像是，而实际上并不是，它有经过公用的互联网。 下图中，场所 A 和 B 的通信经过互联网，如果场所 A 的主机 X 要和另一个场所 B 的主机 Y 通信，IP 数据报的源地址是 10.1.0.1，目的地址是 10.2.0.3。数据报先发送到与互联网相连的路由器 R1，R1 对内部数据进行加密，然后重新加上数据报的首部，源地址是路由器 R1 的全球地址 125.1.2.3，目的地址是路由器 R2 的全球地址 194.4.5.6。路由器 R2 收到数据报后将数据部分进行解密，恢复原来的数据报，此时目的地址为 10.2.0.3，就交付给 Y。  网络地址转换 NAT  专用网内部的主机使用本地 IP 地址又想和互联网上的主机通信时，可以使用 NAT 来将本地 IP 转换为全球 IP。 在以前，NAT 将本地 IP 和全球 IP 一一对应，这种方式下拥有 n 个全球 IP 地址的专用网内最多只可以同时有 n 台主机接入互联网。为了更有效地利用全球 IP 地址，现在常用的 NAT 转换表把传输层的端口号也用上了，使得多个专用网内部的主机共用一个全球 IP 地址。使用端口号的 NAT 也叫做网络地址与端口转换 NAPT。  因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。 因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。 ",
  "wordCount" : "660",
  "inLanguage": "en",
  "datePublished": "2022-05-03T14:41:48+08:00",
  "dateModified": "2022-05-03T14:41:48+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://10cks.top/posts/%E7%AC%AC4%E7%AB%A0-%E7%BD%91%E7%BB%9C%E5%B1%82/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "10cks",
    "logo": {
      "@type": "ImageObject",
      "url": "https://10cks.top/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://10cks.top/" accesskey="h" title="10cks (Alt + H)">10cks</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://10cks.top/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://10cks.top/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://10cks.top/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://10cks.top/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://10cks.top/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://10cks.top/index.xml" title="Rss">
                    <span>Rss</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://10cks.top/">Home</a>&nbsp;»&nbsp;<a href="https://10cks.top/posts/">Posts</a></div>
    <h1 class="post-title">
      第 4 章  网络层
    </h1>
    <div class="post-meta"><span title='2022-05-03 14:41:48 +0800 CST'>May 3, 2022</span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>
            <div class="inner"><ul>
                    <li>
                        <a href="#%e7%bd%91%e7%bb%9c%e5%b1%82%e6%8f%90%e4%be%9b%e7%9a%84%e4%b8%a4%e7%a7%8d%e6%9c%8d%e5%8a%a1" aria-label="网络层提供的两种服务">网络层提供的两种服务</a><ul>
                            
                    <li>
                        <a href="#%e8%99%9a%e7%94%b5%e8%b7%af%e6%9c%8d%e5%8a%a1" aria-label="虚电路服务">虚电路服务</a></li>
                    <li>
                        <a href="#%e6%95%b0%e6%8d%ae%e6%8a%a5%e6%9c%8d%e5%8a%a1" aria-label="数据报服务">数据报服务</a></li>
                    <li>
                        <a href="#%e6%a6%82%e8%a6%81-%e8%99%9a%e7%94%b5%e8%b7%af%e6%9c%8d%e5%8a%a1%e4%b8%8e%e6%95%b0%e6%8d%ae%e6%8a%a5%e6%9c%8d%e5%8a%a1%e7%9a%84%e5%af%b9%e6%af%94" aria-label="概要: 虚电路服务与数据报服务的对比">概要: 虚电路服务与数据报服务的对比</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e7%bd%91%e9%99%85%e5%8d%8f%e8%ae%ae-ip" aria-label="网际协议 IP">网际协议 IP</a><ul>
                            
                    <li>
                        <a href="#%e7%bd%91%e9%99%85%e5%8d%8f%e8%ae%ae-ip-%e6%98%af-tcpip-%e4%bd%93%e7%b3%bb%e4%b8%ad%e4%b8%a4%e4%b8%aa%e6%9c%80%e4%b8%bb%e8%a6%81%e7%9a%84%e5%8d%8f%e8%ae%ae%e4%b9%8b%e4%b8%80%e4%b8%8e-ip-%e5%8d%8f%e8%ae%ae%e9%85%8d%e5%a5%97%e4%bd%bf%e7%94%a8%e7%9a%84%e8%bf%98%e6%9c%89%e5%9b%9b%e4%b8%aa%e5%8d%8f%e8%ae%ae" aria-label="网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：">网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：</a></li>
                    <li>
                        <a href="#%e8%99%9a%e6%8b%9f%e4%ba%92%e8%bf%9e%e7%bd%91%e7%bb%9c" aria-label="虚拟互连网络">虚拟互连网络</a></li>
                    <li>
                        <a href="#ip-%e6%95%b0%e6%8d%ae%e6%8a%a5%e7%9a%84%e6%a0%bc%e5%bc%8f" aria-label="IP 数据报的格式">IP 数据报的格式</a></li>
                    <li>
                        <a href="#%e5%88%86%e7%b1%bb%e7%9a%84-ip-%e5%9c%b0%e5%9d%80" aria-label="分类的 IP 地址">分类的 IP 地址</a></li>
                    <li>
                        <a href="#ip-%e5%9c%b0%e5%9d%80%e4%b8%8e%e7%a1%ac%e4%bb%b6%e5%9c%b0%e5%9d%80" aria-label="IP 地址与硬件地址">IP 地址与硬件地址</a></li>
                    <li>
                        <a href="#%e5%9c%b0%e5%9d%80%e8%a7%a3%e6%9e%90%e5%8d%8f%e8%ae%ae-arp-%e4%b8%8e%e9%80%86%e5%9c%b0%e5%9d%80%e8%a7%a3%e6%9e%90%e5%8d%8f%e8%ae%aerarp" aria-label="地址解析协议 ARP 与逆地址解析协议RARP">地址解析协议 ARP 与逆地址解析协议RARP</a></li>
                    <li>
                        <a href="#ip-%e5%b1%82%e8%bd%ac%e5%8f%91%e5%88%86%e7%bb%84%e7%9a%84%e6%b5%81%e7%a8%8b" aria-label="IP 层转发分组的流程">IP 层转发分组的流程</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%88%92%e5%88%86%e5%ad%90%e7%bd%91%e5%92%8c%e6%9e%84%e9%80%a0%e8%b6%85%e7%bd%91" aria-label="划分子网和构造超网">划分子网和构造超网</a><ul>
                            
                    <li>
                        <a href="#%e5%88%92%e5%88%86%e5%ad%90%e7%bd%91" aria-label="划分子网">划分子网</a></li>
                    <li>
                        <a href="#%e4%bd%bf%e7%94%a8%e5%ad%90%e7%bd%91%e6%97%b6%e5%88%86%e7%bb%84%e8%bd%ac%e5%8f%91" aria-label="使用子网时分组转发">使用子网时分组转发</a></li>
                    <li>
                        <a href="#%e6%97%a0%e5%88%86%e7%b1%bb%e7%bc%96%e5%9d%80-cidr%e6%9e%84%e9%80%a0%e8%b6%85%e7%bd%91" aria-label="无分类编址 CIDR（构造超网）">无分类编址 CIDR（构造超网）</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e7%bd%91%e9%99%85%e6%8e%a7%e5%88%b6%e6%8a%a5%e6%96%87%e5%8d%8f%e8%ae%ae-icmp" aria-label="网际控制报文协议 ICMP">网际控制报文协议 ICMP</a><ul>
                            
                    <li>
                        <a href="#%e7%ae%80%e4%bb%8b" aria-label="简介">简介</a></li>
                    <li>
                        <a href="#icmp-%e6%8a%a5%e6%96%87%e7%9a%84%e7%a7%8d%e7%b1%bb" aria-label="ICMP 报文的种类">ICMP 报文的种类</a></li>
                    <li>
                        <a href="#icmp-%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="ICMP 的应用举例">ICMP 的应用举例</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%9b%a0%e7%89%b9%e7%bd%91%e7%9a%84%e8%b7%af%e7%94%b1%e9%80%89%e6%8b%a9%e5%8d%8f%e8%ae%ae" aria-label="因特网的路由选择协议">因特网的路由选择协议</a><ul>
                            
                    <li>
                        <a href="#%e6%9c%89%e5%85%b3%e8%b7%af%e7%94%b1%e9%80%89%e6%8b%a9%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%87%a0%e4%b8%aa%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5" aria-label="有关路由选择协议的几个基本概念">有关路由选择协议的几个基本概念</a></li>
                    <li>
                        <a href="#%e8%87%aa%e6%b2%bb%e7%b3%bb%e7%bb%9f-asautonomous-system" aria-label="自治系统 AS(Autonomous System)">自治系统 AS(Autonomous System)</a></li>
                    <li>
                        <a href="#%e5%86%85%e9%83%a8%e7%bd%91%e5%85%b3%e5%8d%8f%e8%ae%ae-igp-interior-gateway-protocol" aria-label="内部网关协议 IGP (Interior Gateway Protocol)">内部网关协议 IGP (Interior Gateway Protocol)</a></li>
                    <li>
                        <a href="#%e5%a4%96%e9%83%a8%e7%bd%91%e5%85%b3%e5%8d%8f%e8%ae%ae-bgp-external-gateway-protocol" aria-label="外部网关协议 BGP (External Gateway Protocol)">外部网关协议 BGP (External Gateway Protocol)</a></li>
                    <li>
                        <a href="#%e8%b7%af%e7%94%b1%e5%99%a8%e7%9a%84%e6%9e%84%e6%88%90" aria-label="路由器的构成">路由器的构成</a></li></ul>
                    </li>
                    <li>
                        <a href="#ip-%e5%a4%9a%e6%92%ad" aria-label="IP 多播">IP 多播</a><ul>
                            
                    <li>
                        <a href="#ip-%e5%a4%9a%e6%92%ad%e7%9a%84%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5" aria-label="IP 多播的基本概念">IP 多播的基本概念</a></li>
                    <li>
                        <a href="#%e5%9c%a8%e5%b1%80%e5%9f%9f%e7%bd%91%e4%b8%8a%e8%bf%9b%e8%a1%8c%e7%a1%ac%e4%bb%b6%e5%a4%9a%e6%92%ad" aria-label="在局域网上进行硬件多播">在局域网上进行硬件多播</a></li>
                    <li>
                        <a href="#%e5%9b%a0%e7%89%b9%e7%bd%91%e7%bb%84%e7%ae%a1%e7%90%86%e5%8d%8f%e8%ae%ae-igmp-%e5%92%8c%e5%a4%9a%e6%92%ad%e8%b7%af%e7%94%b1%e9%80%89%e6%8b%a9%e5%8d%8f%e8%ae%ae" aria-label="因特网组管理协议 IGMP 和多播路由选择协议">因特网组管理协议 IGMP 和多播路由选择协议</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e8%99%9a%e6%8b%9f%e4%b8%93%e7%94%a8%e7%bd%91-vpn-%e5%92%8c%e7%bd%91%e7%bb%9c%e5%9c%b0%e5%9d%80%e8%bd%ac%e6%8d%a2-nat" aria-label="虚拟专用网 VPN 和网络地址转换 NAT">虚拟专用网 VPN 和网络地址转换 NAT</a><ul>
                            
                    <li>
                        <a href="#%e8%99%9a%e6%8b%9f%e4%b8%93%e7%94%a8%e7%bd%91-vpn" aria-label="虚拟专用网 VPN">虚拟专用网 VPN</a></li>
                    <li>
                        <a href="#%e7%bd%91%e7%bb%9c%e5%9c%b0%e5%9d%80%e8%bd%ac%e6%8d%a2-nat" aria-label="网络地址转换 NAT">网络地址转换 NAT</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%9b%a0%e4%b8%ba%e7%bd%91%e7%bb%9c%e5%b1%82%e6%98%af%e6%95%b4%e4%b8%aa%e4%ba%92%e8%81%94%e7%bd%91%e7%9a%84%e6%a0%b8%e5%bf%83%e5%9b%a0%e6%ad%a4%e5%ba%94%e5%bd%93%e8%ae%a9%e7%bd%91%e7%bb%9c%e5%b1%82%e5%b0%bd%e5%8f%af%e8%83%bd%e7%ae%80%e5%8d%95%e7%bd%91%e7%bb%9c%e5%b1%82%e5%90%91%e4%b8%8a%e5%8f%aa%e6%8f%90%e4%be%9b%e7%ae%80%e5%8d%95%e7%81%b5%e6%b4%bb%e7%9a%84%e6%97%a0%e8%bf%9e%e6%8e%a5%e7%9a%84%e5%b0%bd%e6%9c%80%e5%a4%a7%e5%8a%aa%e5%8a%9b%e4%ba%a4%e4%ba%92%e7%9a%84%e6%95%b0%e6%8d%ae%e6%8a%a5%e6%9c%8d%e5%8a%a1" aria-label="因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。">因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。</a></li>
                    <li>
                        <a href="#%e5%9b%a0%e4%b8%ba%e7%bd%91%e7%bb%9c%e5%b1%82%e6%98%af%e6%95%b4%e4%b8%aa%e4%ba%92%e8%81%94%e7%bd%91%e7%9a%84%e6%a0%b8%e5%bf%83%e5%9b%a0%e6%ad%a4%e5%ba%94%e5%bd%93%e8%ae%a9%e7%bd%91%e7%bb%9c%e5%b1%82%e5%b0%bd%e5%8f%af%e8%83%bd%e7%ae%80%e5%8d%95%e7%bd%91%e7%bb%9c%e5%b1%82%e5%90%91%e4%b8%8a%e5%8f%aa%e6%8f%90%e4%be%9b%e7%ae%80%e5%8d%95%e7%81%b5%e6%b4%bb%e7%9a%84%e6%97%a0%e8%bf%9e%e6%8e%a5%e7%9a%84%e5%b0%bd%e6%9c%80%e5%a4%a7%e5%8a%aa%e5%8a%9b%e4%ba%a4%e4%ba%92%e7%9a%84%e6%95%b0%e6%8d%ae%e6%8a%a5%e6%9c%8d%e5%8a%a1-1" aria-label="因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。">因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h2 id="网络层提供的两种服务">网络层提供的两种服务<a hidden class="anchor" aria-hidden="true" href="#网络层提供的两种服务">#</a></h2>
<h3 id="虚电路服务">虚电路服务<a hidden class="anchor" aria-hidden="true" href="#虚电路服务">#</a></h3>
<h3 id="数据报服务">数据报服务<a hidden class="anchor" aria-hidden="true" href="#数据报服务">#</a></h3>
<h3 id="概要-虚电路服务与数据报服务的对比">概要: 虚电路服务与数据报服务的对比<a hidden class="anchor" aria-hidden="true" href="#概要-虚电路服务与数据报服务的对比">#</a></h3>
<h2 id="网际协议-ip">网际协议 IP<a hidden class="anchor" aria-hidden="true" href="#网际协议-ip">#</a></h2>
<h3 id="网际协议-ip-是-tcpip-体系中两个最主要的协议之一与-ip-协议配套使用的还有四个协议">网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：<a hidden class="anchor" aria-hidden="true" href="#网际协议-ip-是-tcpip-体系中两个最主要的协议之一与-ip-协议配套使用的还有四个协议">#</a></h3>
<ul>
<li>地址解析协议 ARP (Address Resolution Protocol)</li>
<li>逆地址解析协议 RARP   (Reverse Address Resolution Protocol)</li>
<li>网际控制报文协议 ICMP   (Internet Control Message Protocol)</li>
<li>网际组管理协议 IGMP   (Internet Group Management Protocol)</li>
<li>概要: 示意图</li>
</ul>
<h3 id="虚拟互连网络">虚拟互连网络<a hidden class="anchor" aria-hidden="true" href="#虚拟互连网络">#</a></h3>
<ul>
<li>网络互相连接起来要使用一些中间设备
<ul>
<li>物理层中继系统：转发器(repeater)。</li>
<li>数据链路层中继系统：网桥或桥接器(bridge)。</li>
<li>网络层中继系统：路由器(router)。</li>
<li>网桥和路由器的混合物：桥路器(brouter)。</li>
<li>网络层以上的中继系统：网关(gateway)。</li>
</ul>
</li>
</ul>
<h3 id="ip-数据报的格式">IP 数据报的格式<a hidden class="anchor" aria-hidden="true" href="#ip-数据报的格式">#</a></h3>
<ul>
<li>版本 : 有 4（IPv4）和 6（IPv6）两个值；</li>
<li>首部长度 : 占 4 位，因此最大值为 15。值为 1 表示的是 1 个 32 位字的长度，也就是 4 字节。因为固定部分长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。</li>
<li>区分服务 : 用来获得更好的服务，一般情况下不使用。</li>
<li>总长度 : 包括首部长度和数据部分长度。</li>
<li>生存时间 ：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由器跳数为单位，当 TTL 为 0 时就丢弃数据报。</li>
<li>协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。</li>
<li>首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。</li>
<li>标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。</li>
<li>片偏移 : 和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。
<ul>
<li>IP数据报分片</li>
</ul>
</li>
<li>概要: 示意图</li>
</ul>
<h3 id="分类的-ip-地址">分类的 IP 地址<a hidden class="anchor" aria-hidden="true" href="#分类的-ip-地址">#</a></h3>
<ul>
<li>IP 地址的编址方式经历了三个历史阶段：
<ul>
<li>分类
<ul>
<li>由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。
IP 地址 ::= {&lt; 网络号 &gt;, &lt; 主机号 &gt;}
<ul>
<li>示意图</li>
</ul>
</li>
</ul>
</li>
<li>子网划分
<ul>
<li>通过在主机号字段中拿一部分作为子网号，把两级 IP 地址划分为三级 IP 地址。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>IP 地址 ::= {&lt; 网络号 &gt;, &lt; 子网号 &gt;, &lt; 主机号 &gt;}</p>
<p>要使用子网，必须配置子网掩码。一个 B 类地址的默认子网掩码为 255.255.0.0，如果 B 类地址的子网占两个比特，那么子网掩码为 11111111 11111111 11000000 00000000，也就是 255.255.192.0。</p>
<p>注意，外部网络看不到子网的存在。
* 无分类
* 无分类编址 CIDR 消除了传统 A 类、B 类和 C 类地址以及划分子网的概念，使用网络前缀和主机号来对 IP 地址进行编码，网络前缀的长度可以根据需要变化。</p>
<p>IP 地址 ::= {&lt; 网络前缀号 &gt;, &lt; 主机号 &gt;}</p>
<p>CIDR 的记法上采用在 IP 地址后面加上网络前缀长度的方法，例如 128.14.35.7/20 表示前 20 位为网络前缀。</p>
<p>CIDR 的地址掩码可以继续称为子网掩码，子网掩码首 1 长度为网络前缀的长度。</p>
<p>一个 CIDR 地址块中有很多地址，一个 CIDR 表示的网络就可以表示原来的很多个网络，并且在路由表中只需要一个路由就可以代替原来的多个路由，减少了路由表项的数量。把这种通过使用网络前缀来减少路由表项的方式称为路由聚合，也称为 构成超网 。</p>
<p>在路由表中的项目由“网络前缀”和“下一跳地址”组成，在查找时可能会得到不止一个匹配结果，应当采用最长前缀匹配来确定应该匹配哪一个。</p>
<h3 id="ip-地址与硬件地址">IP 地址与硬件地址<a hidden class="anchor" aria-hidden="true" href="#ip-地址与硬件地址">#</a></h3>
<ul>
<li>IP层抽象的互联网屏蔽了下层很复杂的细节
在抽象的网络层上讨论问题，就能够使用
统一的、抽象的 IP 地址
研究主机和主机或主机和路由器之间的通信
<ul>
<li>示意图</li>
</ul>
</li>
</ul>
<h3 id="地址解析协议-arp-与逆地址解析协议rarp">地址解析协议 ARP 与逆地址解析协议RARP<a hidden class="anchor" aria-hidden="true" href="#地址解析协议-arp-与逆地址解析协议rarp">#</a></h3>
<ul>
<li>缘由
<ul>
<li>网络层实现主机之间的通信，而链路层实现具体每段链路之间的通信。因此在通信过程中，IP 数据报的源地址和目的地址始终不变，而 MAC 地址随着链路的改变而改变。</li>
</ul>
</li>
<li>地址解析协议 ARP
<ul>
<li>ARP 实现由 IP 地址得到 MAC 地址
<ul>
<li>每个主机都有一个 ARP 高速缓存，里面有本局域网上的各主机和路由器的 IP 地址到 MAC 地址的映射表。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>如果主机 A 知道主机 B 的 IP 地址，但是 ARP 高速缓存中没有该 IP 地址到 MAC 地址的映射，此时主机 A 通过广播的方式发送 ARP 请求分组，主机 B 收到该请求后会发送 ARP 响应分组给主机 A 告知其 MAC 地址，随后主机 A 向其高速缓存中写入主机 B 的 IP 地址到 MAC 地址的映射。
* 示意图</p>
<ul>
<li>逆地址解析协议 RARP
<ul>
<li>逆地址解析协议 RARP 使只知道自己硬件地址的主机能够知道其 IP 地址。
<ul>
<li>这种主机往往是无盘工作站。 因此 RARP协议目前已很少使用。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="ip-层转发分组的流程">IP 层转发分组的流程<a hidden class="anchor" aria-hidden="true" href="#ip-层转发分组的流程">#</a></h3>
<ul>
<li>分组转发算法
<ul>
<li>(1)  从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。</li>
<li>(2)  若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行(3)。</li>
<li>(3)  若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行(4)。</li>
<li>(4)  若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行(5)。</li>
<li>(5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行(6)。</li>
<li>(6)  报告转发分组出错。</li>
<li>概要: 示意图</li>
</ul>
</li>
</ul>
<h2 id="划分子网和构造超网">划分子网和构造超网<a hidden class="anchor" aria-hidden="true" href="#划分子网和构造超网">#</a></h2>
<h3 id="划分子网">划分子网<a hidden class="anchor" aria-hidden="true" href="#划分子网">#</a></h3>
<h3 id="使用子网时分组转发">使用子网时分组转发<a hidden class="anchor" aria-hidden="true" href="#使用子网时分组转发">#</a></h3>
<h3 id="无分类编址-cidr构造超网">无分类编址 CIDR（构造超网）<a hidden class="anchor" aria-hidden="true" href="#无分类编址-cidr构造超网">#</a></h3>
<h2 id="网际控制报文协议-icmp">网际控制报文协议 ICMP<a hidden class="anchor" aria-hidden="true" href="#网际控制报文协议-icmp">#</a></h2>
<h3 id="简介">简介<a hidden class="anchor" aria-hidden="true" href="#简介">#</a></h3>
<ul>
<li>ICMP 是为了更有效地转发 IP 数据报和提高交付成功的机会。它封装在 IP 数据报中，但是不属于高层协议。</li>
</ul>
<h3 id="icmp-报文的种类">ICMP 报文的种类<a hidden class="anchor" aria-hidden="true" href="#icmp-报文的种类">#</a></h3>
<ul>
<li>ICMP 差错报告报文
<ul>
<li>终点不可达</li>
<li>源点抑制(Source quench)</li>
<li>时间超过</li>
<li>参数问题</li>
<li>改变路由（重定向）(Redirect)</li>
</ul>
</li>
<li>ICMP 询问报文
<ul>
<li>回送请求和回答报文</li>
<li>时间戳请求和回答报文</li>
</ul>
</li>
<li>ICMP 报文的前 4 个字节是统一的格式，共有三个字段：即类型、代码和检验和。接着的 4 个字节的内容与 ICMP 的类型有关。</li>
</ul>
<h3 id="icmp-的应用举例">ICMP 的应用举例<a hidden class="anchor" aria-hidden="true" href="#icmp-的应用举例">#</a></h3>
<ul>
<li>
<ol>
<li>Ping</li>
</ol>
<ul>
<li>Ping 是 ICMP 的一个重要应用，主要用来测试两台主机之间的连通性。</li>
</ul>
</li>
</ul>
<p>Ping 的原理是通过向目的主机发送 ICMP Echo 请求报文，目的主机收到之后会发送 Echo 回答报文。Ping 会根据时间和成功响应的次数估算出数据包往返时间以及丢包率。</p>
<ul>
<li>
<ol start="2">
<li>Traceroute</li>
</ol>
<ul>
<li>Traceroute 是 ICMP 的另一个应用，用来跟踪一个分组从源点到终点的路径。</li>
</ul>
</li>
</ul>
<p>Traceroute 发送的 IP 数据报封装的是无法交付的 UDP 用户数据报，并由目的主机发送终点不可达差错报告报文。
* 源主机向目的主机发送一连串的 IP 数据报。第一个数据报 P1 的生存时间 TTL 设置为 1，当 P1 到达路径上的第一个路由器 R1 时，R1 收下它并把 TTL 减 1，此时 TTL 等于 0，R1 就把 P1 丢弃，并向源主机发送一个 ICMP 时间超过差错报告报文；
* 源主机接着发送第二个数据报 P2，并把 TTL 设置为 2。P2 先到达 R1，R1 收下后把 TTL 减 1 再转发给 R2，R2 收下后也把 TTL 减 1，由于此时 TTL 等于 0，R2 就丢弃 P2，并向源主机发送一个 ICMP 时间超过差错报文。
* 不断执行这样的步骤，直到最后一个数据报刚刚到达目的主机，主机不转发数据报，也不把 TTL 值减 1。但是因为数据报封装的是无法交付的 UDP，因此目的主机要向源主机发送 ICMP 终点不可达差错报告报文。
* 之后源主机知道了到达目的主机所经过的路由器 IP 地址以及到达每个路由器的往返时间。</p>
<h2 id="因特网的路由选择协议">因特网的路由选择协议<a hidden class="anchor" aria-hidden="true" href="#因特网的路由选择协议">#</a></h2>
<h3 id="有关路由选择协议的几个基本概念">有关路由选择协议的几个基本概念<a hidden class="anchor" aria-hidden="true" href="#有关路由选择协议的几个基本概念">#</a></h3>
<ul>
<li>静态路由选择策略——即非自适应路由选择，其特点是简单和开销较小，但不能及时适应网络状态的变化。</li>
<li>动态路由选择策略——即自适应路由选择，其特点是能较好地适应网络状态的变化，但实现起来较为复杂，开销也比较大。</li>
</ul>
<h3 id="自治系统-asautonomous-system">自治系统 AS(Autonomous System)<a hidden class="anchor" aria-hidden="true" href="#自治系统-asautonomous-system">#</a></h3>
<ul>
<li>自治系统 AS 的定义：在单一的技术管理下的一组路由器，而这些路由器使用一种 AS 内部的路由选择协议和共同的度量以确定分组在该 AS 内的路由，同时还使用一种 AS 之间的路由选择协议用以确定分组在 AS之间的路由。</li>
</ul>
<h3 id="内部网关协议-igp-interior-gateway-protocol">内部网关协议 IGP (Interior Gateway Protocol)<a hidden class="anchor" aria-hidden="true" href="#内部网关协议-igp-interior-gateway-protocol">#</a></h3>
<ul>
<li>即在一个自治系统内部使用的路由选择协议。
<ul>
<li>内部网关协议 RIP
<ul>
<li>RIP 是一种基于距离向量的路由选择协议。距离是指跳数，直接相连的路由器跳数为 1。跳数最多为 15，超过 15 表示不可达。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>RIP 按固定的时间间隔仅和相邻路由器交换自己的路由表，经过若干次交换之后，所有路由器最终会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器地址。
* 距离向量算法：
* 对地址为 X 的相邻路由器发来的 RIP 报文，先修改报文中的所有项目，把下一跳字段中的地址改为 X，并把所有的距离字段加 1；
* 对修改后的 RIP 报文中的每一个项目，进行以下步骤：
* 若原来的路由表中没有目的网络 N，则把该项目添加到路由表中；
* 否则：若下一跳路由器地址是 X，则把收到的项目替换原来路由表中的项目；否则：若收到的项目中的距离 d 小于路由表中的距离，则进行更新（例如原始路由表项为 Net2, 5, P，新表项为 Net2, 4, X，则更新）；否则什么也不做。
* 若 3 分钟还没有收到相邻路由器的更新路由表，则把该相邻路由器标为不可达，即把距离置为 16。
* RIP 协议实现简单，开销小。但是 RIP 能使用的最大距离为 15，限制了网络的规模。并且当网络出现故障时，要经过比较长的时间才能将此消息传送到所有路由器。
* 内部网关协议 OSPF
* 开放最短路径优先 OSPF，是为了克服 RIP 的缺点而开发出来的。</p>
<p>开放表示 OSPF 不受某一家厂商控制，而是公开发表的；最短路径优先表示使用了 Dijkstra 提出的最短路径算法 SPF。
* OSPF 具有以下特点：
* 向本自治系统中的所有路由器发送信息，这种方法是洪泛法。
* 发送的信息就是与相邻路由器的链路状态，链路状态包括与哪些路由器相连以及链路的度量，度量用费用、距离、时延、带宽等来表示。
* 只有当链路状态发生变化时，路由器才会发送信息。
* 所有路由器都具有全网的拓扑结构图，并且是一致的。相比于 RIP，OSPF 的更新过程收敛的很快。</p>
<h3 id="外部网关协议-bgp-external-gateway-protocol">外部网关协议 BGP (External Gateway Protocol)<a hidden class="anchor" aria-hidden="true" href="#外部网关协议-bgp-external-gateway-protocol">#</a></h3>
<ul>
<li>若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。</li>
<li>AS 之间的路由选择很困难，主要是由于：
<ul>
<li>互联网规模很大；</li>
<li>各个 AS 内部使用不同的路由选择协议，无法准确定义路径的度量；</li>
<li>AS 之间的路由选择必须考虑有关的策略，比如有些 AS 不愿意让其它 AS 经过。</li>
</ul>
</li>
<li>BGP 只能寻找一条比较好的路由，而不是最佳路由。</li>
</ul>
<p>每个 AS 都必须配置 BGP 发言人，通过在两个相邻 BGP 发言人之间建立 TCP 连接来交换路由信息。
* 示意图</p>
<h3 id="路由器的构成">路由器的构成<a hidden class="anchor" aria-hidden="true" href="#路由器的构成">#</a></h3>
<ul>
<li>路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任务是转发分组。也就是说，将路由器某个输入端口收到的分组，按照分组要去的目的地（即目的网络），把该分组从路由器的某个合适的输出端口转发给下一跳路由器。</li>
<li>路由器从功能上可以划分为
<ul>
<li>路由选择</li>
<li>分组转发</li>
</ul>
</li>
<li>分组转发结构由三个部分组成
<ul>
<li>交换结构</li>
<li>一组输入端口</li>
<li>一组输出端口</li>
<li>概要: 示意图</li>
</ul>
</li>
</ul>
<h2 id="ip-多播">IP 多播<a hidden class="anchor" aria-hidden="true" href="#ip-多播">#</a></h2>
<h3 id="ip-多播的基本概念">IP 多播的基本概念<a hidden class="anchor" aria-hidden="true" href="#ip-多播的基本概念">#</a></h3>
<ul>
<li>多播可明显地减少网络中资源的消耗</li>
</ul>
<h3 id="在局域网上进行硬件多播">在局域网上进行硬件多播<a hidden class="anchor" aria-hidden="true" href="#在局域网上进行硬件多播">#</a></h3>
<h3 id="因特网组管理协议-igmp-和多播路由选择协议">因特网组管理协议 IGMP 和多播路由选择协议<a hidden class="anchor" aria-hidden="true" href="#因特网组管理协议-igmp-和多播路由选择协议">#</a></h3>
<ul>
<li>IGMP 使多播路由器知道多播组成员信息</li>
<li>多播转发必须动态地适应多播组成员的变化（这时网络拓扑并未发生变化）。请注意，单播路由选择通常是在网络拓扑发生变化时才需要更新路由。</li>
</ul>
<h2 id="虚拟专用网-vpn-和网络地址转换-nat">虚拟专用网 VPN 和网络地址转换 NAT<a hidden class="anchor" aria-hidden="true" href="#虚拟专用网-vpn-和网络地址转换-nat">#</a></h2>
<h3 id="虚拟专用网-vpn">虚拟专用网 VPN<a hidden class="anchor" aria-hidden="true" href="#虚拟专用网-vpn">#</a></h3>
<ul>
<li>由于 IP 地址的紧缺，一个机构能申请到的 IP 地址数往往远小于本机构所拥有的主机数。并且一个机构并不需要把所有的主机接入到外部的互联网中，机构内的计算机可以使用仅在本机构有效的 IP 地址（专用地址）。
<ul>
<li>有三个专用地址块：
<ul>
<li>10.0.0.0 ~ 10.255.255.255</li>
<li>172.16.0.0 ~ 172.31.255.255</li>
<li>192.168.0.0 ~ 192.168.255.255</li>
</ul>
</li>
</ul>
</li>
<li>VPN 使用公用的互联网作为本机构各专用网之间的通信载体。专用指机构内的主机只与本机构内的其它主机通信；虚拟指好像是，而实际上并不是，它有经过公用的互联网。</li>
<li>下图中，场所 A 和 B 的通信经过互联网，如果场所 A 的主机 X 要和另一个场所 B 的主机 Y 通信，IP 数据报的源地址是 10.1.0.1，目的地址是 10.2.0.3。数据报先发送到与互联网相连的路由器 R1，R1 对内部数据进行加密，然后重新加上数据报的首部，源地址是路由器 R1 的全球地址 125.1.2.3，目的地址是路由器 R2 的全球地址 194.4.5.6。路由器 R2 收到数据报后将数据部分进行解密，恢复原来的数据报，此时目的地址为 10.2.0.3，就交付给 Y。</li>
</ul>
<h3 id="网络地址转换-nat">网络地址转换 NAT<a hidden class="anchor" aria-hidden="true" href="#网络地址转换-nat">#</a></h3>
<ul>
<li>专用网内部的主机使用本地 IP 地址又想和互联网上的主机通信时，可以使用 NAT 来将本地 IP 转换为全球 IP。</li>
<li>在以前，NAT 将本地 IP 和全球 IP 一一对应，这种方式下拥有 n 个全球 IP 地址的专用网内最多只可以同时有 n 台主机接入互联网。为了更有效地利用全球 IP 地址，现在常用的 NAT 转换表把传输层的端口号也用上了，使得多个专用网内部的主机共用一个全球 IP 地址。使用端口号的 NAT 也叫做网络地址与端口转换 NAPT。</li>
</ul>
<h2 id="因为网络层是整个互联网的核心因此应当让网络层尽可能简单网络层向上只提供简单灵活的无连接的尽最大努力交互的数据报服务">因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。<a hidden class="anchor" aria-hidden="true" href="#因为网络层是整个互联网的核心因此应当让网络层尽可能简单网络层向上只提供简单灵活的无连接的尽最大努力交互的数据报服务">#</a></h2>
<h2 id="因为网络层是整个互联网的核心因此应当让网络层尽可能简单网络层向上只提供简单灵活的无连接的尽最大努力交互的数据报服务-1">因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。<a hidden class="anchor" aria-hidden="true" href="#因为网络层是整个互联网的核心因此应当让网络层尽可能简单网络层向上只提供简单灵活的无连接的尽最大努力交互的数据报服务-1">#</a></h2>


  </div>

  <footer class="post-footer">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://10cks.top/posts/%E7%AC%AC3%E7%AB%A0-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/">
    <span class="title">« Prev Page</span>
    <br>
    <span>第 3 章  数据链路层</span>
  </a>
  <a class="next" href="https://10cks.top/posts/%E7%AC%AC5%E7%AB%A0-%E8%BF%90%E8%BE%93%E5%B1%82/">
    <span class="title">Next Page »</span>
    <br>
    <span>第 5 章 运输层</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://10cks.top/">10cks</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<script
    src="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/nprogress.min.js"
    integrity="sha384-bHDlAEUFxsRI7JfULv3DTpL2IXbbgn4JHQJibgo5iiXSK6Iu8muwqHANhun74Cqg"
    crossorigin="anonymous"
></script>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/css/nprogress.css"
    integrity="sha384-KJyhr2syt5+4M9Pz5dipCvTrtvOmLk/olWVdfhAp858UCa64Ia5GFpTN7+G4BWpE"
    crossorigin="anonymous"
/>
<script>
    NProgress.start();
    document.addEventListener("readystatechange", () => {
        if (document.readyState === "interactive") NProgress.inc(0.8);
        if (document.readyState === "complete") NProgress.done();
    });
</script>

</body>

</html>
